var PhotoViewer={is_setup:!1,c:null,is_viewer:!1,last_scroll_top:0,timeout:null,total_count:0,photos:{},album_title:"",album_href:"",owner_title:"",owner_href:"",slideshow_is_stop:!0,slideshow_is_pause:!1,scale:1,move:{top:0,left:0},comments:{},options:{album_id:0,photo_id:0,isPage:0,slideshow_time:3E3,min_scale:1,max_scale:3,scale_step:10,urlPhoto:"",urlComment:"",ajaxResponder:""},open:function(a){var b=this;this.options.photo_id=a.photo_id;this.options.isPage=a.isPage;this.setup();b.last_scroll_top=
$(window).scrollTop();this.viewer();this.reset();b.viewer().addClass("active");setTimeout(function(){$(window).scrollTop(0);$("html").addClass("hideScroll");b.resize();b.loadPhoto()},10);this.old_comments_block=$(".layout_core_comments");this.setIdPrefix(this.old_comments_block)},hide:function(){this.viewer().hasClass("fullmode")?this.fullHide():(this.viewer().removeClass("active"),$("html").removeClass("hideScroll"),$(window).scrollTop(this.last_scroll_top),this.removeIdPrefix(this.old_comments_block))},
resize:function(){var a=$(window).width(),b=$(window).height();if(this.viewer().hasClass("fullmode"))$("#wpPhotoViewer").find(".wpPhotoContent, .wpCommentsContent").css("height",b),$("#wpPhotoViewer").find(".wpPhoto").css("width",a),$("#wpPhotoViewer").find(".wpNext, .wpPrev").css("right",0);else{var a=a-50,b=b-50,c=b-70;$("#wpPhotoViewer").find(".wpPhotoContent, .wpCommentsContent").css("height",c);$("#wpPhotoViewer").find(".wpPhoto").css("width",a-400);$("#wpPhotoViewer").find(".wpComments").css("width",
400);$("#wpPhotoViewer").find(".wpNext, .wpPrev").css("right",390)}$("#wpPhotoViewer").find(".wpNext, .wpPrev").css("line-height",b+"px");0<this.viewer().find(".photos").width()-100*this.total_count?this.viewer().find(".wpPhotoList").addClass("one_col"):this.viewer().find(".wpPhotoList").removeClass("one_col");this.hideOptions()},loadPhoto:function(){var a=this;$.ajax({url:this.options.urlPhoto,data:{format:"json",photo_id:this.options.photo_id,isPage:this.options.isPage},dataType:"json",success:function(b){if(b&&
b.photos){a.total_count=b.count;a.album_title=b.album_title;a.album_href=b.album_href;a.owner_title=b.owner_title;a.owner_href=b.owner_href;a.photos={};var c=0,d="";$(b.photos).each(function(b,f){d+='<a href="javascript:void(0);" class="wpPhotoItem" onclick="PhotoViewer.view('+f.photo_id+');" id="wp_'+f.photo_id+'"><img id="fullphoto_'+f.photo_id+'" src="'+f.thumb+'" alt=""/></a>';a.photos[f.photo_id]=f;0==b&&(c=f.photo_id);f.active&&(c=f.photo_id)});a.viewer().find(".wpPhotoList").find(".photos").html(d);
a.viewer().find(".wpPhotoList").find(".photos").find("img").load(function(){$(this).addClass("loaded")});a.viewer().find(".wpPhotoList").find(".count").html(a.total_count);1<a.total_count&&a.viewer().find(".allPhotos").show();a.viewer().find(".goSlideshow").show();a.view(c);a._checkPagination();a.resize()}}})},view:function(a){if(this.photos[a]){var b=this.photos[a];this.viewer().find(".wpPhotoItem").removeClass("active");this.viewer().find("#wp_"+a).addClass("active");var c=this.viewer().find("#wp_"+
a).prevAll().length+1,d=this.viewer().find(".wpPhotoContent");d.find(".active").removeClass("active").removeClass("fade");var e=d.find("#thephoto_"+a);e.length?(e.addClass("active"),setTimeout(function(){e.addClass("fade")},10)):(d.append($('<div class="thephoto" id="thephoto_'+a+'"><div class="moveElement"><div id="imgPlace_'+a+'"><img src="'+b.src+'" alt=""/></div><span class="photo_options"><a href="javascript:void(0);" class="openfull icon-resize-full" onclick="PhotoViewer.fullOpen();"></a><a href="javascript:void(0);" class="hidefull icon-resize-small" onclick="PhotoViewer.fullHide();"></a></span></div></div>')),
e=$("#thephoto_"+a),clearTimeout(this.photo),this.photo=setTimeout(function(){e.addClass("active");setTimeout(function(){e.addClass("fade")},10)},10));this.resize();this.viewer().find(".wpPhotoOptions").find(".info").show();b=this.viewer().find(".wpPhotoOptions").find(".album_info");b.find(".album_title").html('<a href="'+this.album_href+'">'+this.album_title+"</a>");b.find(".album_owner").html(' - <a href="'+this.owner_href+'">'+this.owner_title+"</a>");this.viewer().find(".wpPhotoOptions").find(".count").find(".total").html(this.total_count);
this.viewer().find(".wpPhotoOptions").find(".count").find(".current").html(c);this.loadComments(a);this._checkPagination()}},_checkPagination:function(){var a=this.viewer().find(".wpNext"),b=this.viewer().find(".wpPrev");if(2>this.total_count)a.hide(),b.hide();else{var c=this.viewer().find(".wpPhotoItem.active");c.prev().length?b.show():b.hide();c.next().length?a.show():a.hide()}},next:function(a){var b=this.viewer().find(".wpPhotoItem.active");b.next().length?b.next().click():a?a():this.showList();
this._checkPagination()},prev:function(){var a=this.viewer().find(".wpPhotoItem.active");a.prev().length?a.prev().click():this.showList();this._checkPagination()},toggleList:function(){this.viewer().find(".wpPhotoList").hasClass("active")?this.hideList():this.showList()},showList:function(){2>this.total_count||this.viewer().hasClass("fullmode")||(this.viewer().find(".photos").jScrollPane(),this.viewer().find(".wpPhotoList").addClass("active"),this.showOver())},isListActive:function(){return this.viewer().find(".wpPhotoList").hasClass("active")},
hideList:function(){this.viewer().find(".wpPhotoList").removeClass("active");this.hideOver()},loadComments:function(a){var b=this;$("#photo_comment_"+a).length&&$("#photo_comment_"+a).remove();this.comment_request&&this.comment_request.abort();b.showLoading();this.comment_request=$.ajax({url:this.options.urlComment,data:{format:"html",photo_id:a,isPage:this.options.isPage},dataType:"json",success:function(c){b.hideLoading();b.setIdPrefix(b.viewer().find(".wpCommentsContent").find(".photo_comment").hide());
var d=$("<div />").attr({id:"photo_comment_"+a,"class":"photo_comment"});d.html($(c.html));b.viewer().find(".wpCommentsContent").append(d);OW.bindAutoClicks($(c.html));OW.bindTips($(c.html));b.addCmpMarkup(c);$("#btn-photo-edit-"+a).click(function(){window.edit_photo_floatbox=OW.ajaxFloatBox("PHOTO_CMP_EditPhoto",{photoId:a},{width:500,iconClass:"ow_ic_edit",title:OW.getLanguageText("photo","tb_edit_photo"),onLoad:function(){var e=$("#photo-desc-area").get(0);e.htmlarea();e.htmlareaRefresh();owForms["photo-edit-form"].bind("success",
function(e){window.edit_photo_floatbox.close();b.loadComments(a)})}})});$("#photo-mark-featured-"+a).click(function(){var a=$(this).attr("rel"),c=$(this).attr("photo-id"),d=this;$.ajax({url:b.options.ajaxResponder,type:"POST",data:{ajaxFunc:"ajaxSetFeaturedStatus",photoId:c,status:a},dataType:"json",success:function(b){if(!0==b.result){var c="remove_from_featured"==a?"mark_featured":"remove_from_featured",f="remove_from_featured"==a?OW.getLanguageText("photo","mark_featured"):OW.getLanguageText("photo",
"remove_from_featured");$(d).html('<i class="icon-picture"></i>'+f);$(d).attr("rel",c);OW.info(b.msg)}else void 0!=b.error&&OW.warning(b.error)}})});$("#photo-delete-"+a).click(function(){if(confirm(OW.getLanguageText("photo","confirm_delete")))$.ajax({url:b.options.ajaxResponder,type:"POST",data:{ajaxFunc:"ajaxDeletePhoto",photoId:a},dataType:"json",success:function(a){!0==a.result?(OW.info(a.msg),a.url&&(document.location=a.url)):void 0!=a.error&&OW.warning(a.error)}});else return!1});$("#btn-photo-flag-"+
a).click(function(){var a=$(this).attr("rel"),b=$(this).attr("url"),c=$("#photo-description").html();null==c&&(c=a);OW.flagContent("photo",a,c,b,"photo+flags")});OW.bind("base.comment_add",function(a){OW.unbind("base.comment_add")});OW.bind("base.comment_delete",function(a){OW.unbind("base.comment_delete")});OW.bind("base.rate_update",function(a){OW.unbind("base.rate_update")})}})},addCmpMarkup:function(a){a.css&&OW.addCss(a.css);a.scriptFiles?OW.addScriptFiles(a.scriptFiles,function(){a.onloadScript&&
OW.addScript(a.onloadScript)}):a.onloadScript&&OW.addScript(a.onloadScript)},setIdPrefix:function(a){},removeIdPrefix:function(a){a.find(".iswphprefix").each(function(a,c){var d=$(c).attr("id"),e=d.indexOf("wphEnd");-1!==e&&(d=d.substr(e+6),$(c).attr("id",d),$(c).removeClass("iswphprefix"))})},onError:function(a){alert(a)},setup:function(){var a=this;this.is_setup||(this.is_setup=!0,$(window).resize(function(){a.resize()}),$(document).bind("keydown",function(b){var c=$(b.target).prop("tagName").toLowerCase();
"textarea"!=c&&("input"!=c&&"select"!=c)&&(a.isListActive()||(37==b.keyCode?a.prev():39==b.keyCode?a.next():0!=b.keyCode&&(27==b.keyCode?a.viewer().hasClass("fullmode")?a.fullHide():a.hide():109==b.keyCode||38==b.keyCode?a.zoom(2):107!=b.keyCode&&40!=b.keyCode||a.zoom(-2))))}),this.viewer().find(".wpPhoto").mousewheel(function(b){if(!a.viewer().hasClass("tagging_process")){b=b.originalEvent;var c=0;b.wheelDelta&&(c=b.wheelDelta/120);b.detail&&(c=-b.detail/3);a.zoom(c)}}),this.viewer().click(function(b){$(b.target).closest(".external-options").length||
($(b.target).hasClass("actions")||$(b.target).parent().hasClass("actions"))||a.hideOptions()}),document.addEventListener&&(document.addEventListener("fullscreenchange",function(){},!1),document.addEventListener("mozfullscreenchange",function(){a.fullToggle(document.mozFullScreen)},!1),document.addEventListener("webkitfullscreenchange",function(){a.fullToggle(document.webkitIsFullScreen)},!1)))},fullToggle:function(a){a?this.fullOpen():this.fullHide()},zoom:function(a){if(!this.isListActive())if(a/=
this.options.scale_step,this.scale+=a,this.scale<this.options.min_scale)this.viewer().removeClass("zooming"),this.scale-=a;else if(this.scale>this.options.max_scale)this.scale-=a;else if(this.viewer().addClass("zooming"),$("#wpPhotoViewer").find(".wpPhoto").find(".active").css("-moz-transform","scale("+this.scale+")").css("-webkit-transform","scale("+this.scale+")").css("transform","scale("+this.scale+")"),a=this.getInternetExplorerVersion(),7==a||8==a)a=$("#wpPhotoViewer").find(".wpPhoto").find(".active").find("img"),
a.data("original-width")||(a.data("original-width",a.width()),a.data("original-height",a.height())),a.css("width",a.data("original-width")*this.scale).css("height",a.data("original-height")*this.scale)},getInternetExplorerVersion:function(){var a=-1;"Microsoft Internet Explorer"==navigator.appName&&null!=/MSIE ([0-9]{1,}[.0-9]{0,})/.exec(navigator.userAgent)&&(a=parseFloat(RegExp.$1));return a},noZoom:function(a){a?this.viewer().addClass("nozoom"):this.viewer().removeClass("nozoom")},fullOpen:function(){var a=
this.viewer();a.addClass("fullmode");this.resize();a=a[0];a.requestFullScreen&&a.requestFullScreen();a.webkitRequestFullScreen&&a.webkitRequestFullScreen();a.mozRequestFullScreen&&a.mozRequestFullScreen();a.requestFullscreen&&a.requestFullscreen()},fullHide:function(){this.viewer().removeClass("fullmode");this.resize();this.stopSlideshow();this.viewer().removeClass("slideshow_process");this.viewer().find(".wpSlideshow").hide();document.cancelFullScreen&&document.cancelFullScreen();document.webkitCancelFullScreen&&
document.webkitCancelFullScreen();document.mozCancelFullScreen&&document.mozCancelFullScreen();document.exitFullscreen&&document.exitFullscreen()},viewer:function(){var a=this;if(this.is_viewer)return this.c;this.is_viewer=!0;var b=$("<div />");b.attr({id:"wpPhotoViewer","class":"wpPhotoViewer"});b.html(this.getHtmlContent());b.appendTo($("body"));var c=this.getInternetExplorerVersion();-1!==c&&(b.addClass("wpIe"),b.addClass("wpIe"+c));clearTimeout(a.mouseTimer);b.mouseover(function(){clearTimeout(a.mouseTimer);
a.mouseTimer=setTimeout(function(){a.viewer().addClass("mouseActive");clearTimeout(a.mouseTimerOut);a.mouseTimerOut=setTimeout(function(){a.viewer().removeClass("mouseActive")},2E3)},10)});var d=b.find(".wpPhotoContent");d.unbind("mousemove").mousemove(function(b){if(!$(b.target).closest("#lassoMask").length)return a.is_pressed&&(clearInterval(a.moving_timer),a.moving_timer=setTimeout(function(){var c=a.move.startClientX-b.clientX,d=a.move.startClientY-b.clientY;a.move.startClientX=b.clientX;a.move.startClientY=
b.clientY;a.photoMove(c,d)},1)),!1});d.unbind("mousedown").mousedown(function(b){if(!$(b.target).closest("#lassoMask").length)return a.is_pressed=!0,a.move.startClientX=b.clientX,a.move.startClientY=b.clientY,d.addClass("moving"),!1});d.unbind("mouseup").mouseup(function(b){if(!$(b.target).closest("#lassoMask").length)return a.is_pressed=!1,d.removeClass("moving"),!1});d.unbind("mouseout").mouseout(function(b){if(!$(b.target).closest("#lassoMask").length)return a.is_pressed=!1,d.removeClass("moving"),
!1});return this.c=b},photoMove:function(a,b){var c=$("#thephoto_"+this.getActiveId());this.move.top+=1.5*-b;this.move.left+=1.5*-a;c.css("margin-top",this.move.top);c.css("margin-left",this.move.left)},showOver:function(){var a=this;this.viewer().find(".wpOver").show();clearTimeout(this.timeout);this.timeout=setTimeout(function(){a.viewer().find(".wpOver").addClass("active")},100)},hideOver:function(){var a=this;a.viewer().find(".wpOver").removeClass("active");clearTimeout(this.timeout);this.timeout=
setTimeout(function(){a.viewer().find(".wpOver").hide()},500)},slideshow:function(){this.fullOpen();this.startSlideshow()},slideshowClose:function(){this.stopSlideshow();this.fullHide();this.viewer().removeClass("slideshow_process");this.viewer().find(".wpSlideshow").hide()},startSlideshow:function(){var a=this;this.stopSlideshow();this.slideshow_is_pause=this.slideshow_is_stop=!1;this.viewer().addClass("slideshow_process");this.slideshow_timer=setInterval(function(){a.slideshow_is_pause||a.next(function(){a.stopSlideshow()})},
this.options.slideshow_time);this._checkStatusSlideShow()},stopSlideshow:function(){clearInterval(this.slideshow_timer);this.slideshow_is_stop=!0;this._checkStatusSlideShow()},repeatSlideshow:function(){this.viewer().find(".photos").find("a:first").click();this.startSlideshow();this._checkStatusSlideShow()},_checkStatusSlideShow:function(){this.slideshow_is_pause?(this.viewer().find(".wpSlidStart").show(),this.viewer().find(".wpSlidPause").hide(),this.viewer().find(".wpSlidRepeat").hide()):this.slideshow_is_stop?
(this.viewer().find(".wpSlidStart").hide(),this.viewer().find(".wpSlidPause").hide(),this.viewer().find(".wpSlidRepeat").show()):(this.viewer().find(".wpSlidStart").hide(),this.viewer().find(".wpSlidPause").show(),this.viewer().find(".wpSlidRepeat").hide())},pauseSlideshow:function(){this.slideshow_is_pause=!0;this._checkStatusSlideShow()},hideOptions:function(){$("#photo_comment_"+this.getActiveId()).find(".external-options").hide()},toggleOptions:function(){var a=$("#photo_comment_"+this.getActiveId()).find(".external-options");
a.toggle();var b=$("#photo_comment_"+this.getActiveId()).find(".actions").offset();a.css("top",32).css("left",b.left)},getActiveId:function(){var a=this.viewer().find(".photos").find(".active");if(a.length)return a.attr("id").substr(3)},getActive:function(){return this.photos[this.getActiveId()]},getHtmlContent:function(){return'<div class="wpContainer"><a href="javascript:void(0);" class="wpPrev icon-angle-left" onclick="PhotoViewer.prev();" style="display: none;"></a><a href="javascript:void(0);" class="wpNext icon-angle-right" onclick="PhotoViewer.next();" style="display: none;"></a><a href="javascript:void(0);" class="wpClose icon-remove" onclick="PhotoViewer.hide();"></a><div class="wpPhoto"><table width="100%" class="wpPhotoContentTable"><tr><td align="center" valign="center" class="wpPhotoContent"></td></tr></table></div><div class="wpComments"><div class="wpCommentsContent"><div class="photo_comment loadingComments"><div class="layout_page_photoviewer_index_comments"><div class="generic_layout_container layout_main"><span class="loading">'+
OW.getLanguageText("gphotoviewer","loading")+'</span></div></div></div></div></div><div class="wpBar"><div class="wpPhotoList"><div class="title">'+OW.getLanguageText("gphotoviewer","all_photos")+'&nbsp;(<span class="count">0</span>)<a href="javascript:void(0);" onclick="PhotoViewer.hideList();" class="wpListClose"><i class="icon-remove"></i></a></div><div class="photos"></div></div><div class="wpPhotoOptions"><div class="leftside"><a href="javascript:void(0);" class="wpbtn wpbtn-inverse allPhotos" onclick="PhotoViewer.toggleList();" style="display: none;">'+
OW.getLanguageText("gphotoviewer","all_photos")+'<i class="right icon-caret-up"></i></a><a href="javascript:void(0);" class="wpbtn wpbtn-inverse goSlideshow" onclick="PhotoViewer.slideshow();" style="display: none;">'+OW.getLanguageText("gphotoviewer","slideshow")+'</a><div class="info" style="display: none;"><div class="album_info"><span class="album_title"></span><span class="album_owner"></span></div><div class="count"><span class="current"></span>&nbsp;'+OW.getLanguageText("gphotoviewer","from")+
'&nbsp;<span class="total"></span></div></div></div></div></div></div><div class="wpSlideshow" style="display: none;"><a href="javascript:void(0);" onclick="PhotoViewer.startSlideshow();" style="display: none;" class="wpSlidStart wpbtn wpbtn-inverse">'+OW.getLanguageText("gphotoviewer","play")+'</a><a href="javascript:void(0);" onclick="PhotoViewer.pauseSlideshow();" style="display: none;" class="wpSlidPause wpbtn wpbtn-inverse">'+OW.getLanguageText("gphotoviewer","pause")+'</a><a href="javascript:void(0);" onclick="PhotoViewer.repeatSlideshow();" style="display: none;" class="wpSlidRepeat wpbtn wpbtn-inverse">'+
OW.getLanguageText("gphotoviewer","repeat")+'</a><a href="javascript:void(0);" onclick="PhotoViewer.slideshowClose();" class="wpSlidClose wpbtn wpbtn-inverse"><i class="icon-remove"></i></a></div><div class="wpOver" onclick="PhotoViewer.hideList();" style="display: none;"></div>'},reset:function(){this.viewer().find(".photos").jScrollPane().data("jsp").destroy();this.viewer().find(".wpOver, .wpNext, .wpPrev, .info, .allPhotos, .goSlideshow, .wpSlideshow, .wpSlidStart, .wpSlidPause, .wpSlidRepeat").hide();
this.viewer().find(".wpPhotoContent, .photos").empty();this.viewer().find(".wpCommentsContent").children().hide();this.viewer().removeClass("fullmode").removeClass("zooming").removeClass("slideshow_process").removeClass("mouseActive");this.viewer().find(".wpPhotoList").removeClass(".one_col");this.viewer().find(".wpCommentsContent").children(".loadingComments").show();return this.viewer()},showLoading:function(){this.viewer().find(".wpCommentsContent").children().hide();this.viewer().find(".wpCommentsContent").children(".loadingComments").show()},
hideLoading:function(){this.viewer().find(".wpCommentsContent").children(".loadingComments").hide()},bindPhotoViewer:function(){$&&$(".ow_page_container").find("a").not(".wp_init").addClass("wp_init").each(function(a,b){var c=$(b).attr("href");if(c&&"javascript:void(0)"!=c){var d=0;(c=c.match(/photo\/view\/([0-9]{0,})/i))||(d=1);c&&(c[0]&&c[1])&&(c=c[1],$(b).unbind("click"),$(b).attr("onclick","").data("photo_id",c).data("isPage",d).click(function(a){a.stopPropagation();a.preventDefault();PhotoViewer.open({photo_id:$(this).data("photo_id"),
isPage:$(this).data("isPage")})}))}})}};