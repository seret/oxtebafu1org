var VideoViewer={is_setup:!1,c:null,is_viewer:!1,last_scroll_top:0,timeout:null,total_count:0,videos:{},album_title:"",album_href:"",owner_title:"",owner_href:"",slideshow_is_stop:!0,slideshow_is_pause:!1,scale:1,move:{top:0,left:0},comments:{},options:{album_id:0,video_id:0,isPage:0,slideshow_time:3E3,min_scale:1,max_scale:3,scale_step:10,urlVideo:"",urlComment:"",ajaxResponder:""},open:function(a){var b=this;this.options.video_id=a.video_id;this.options.isPage=a.isPage;this.setup();b.last_scroll_top=
$(window).scrollTop();this.viewer();this.reset();b.viewer().addClass("active");setTimeout(function(){$(window).scrollTop(0);$("html").addClass("hideScroll");b.resize();b.loadVideo()},10);this.old_comments_block=$(".layout_core_comments");this.setIdPrefix(this.old_comments_block)},hide:function(){this.viewer().hasClass("fullmode")?this.fullHide():(this.viewer().removeClass("active"),$("html").removeClass("hideScroll"),$(window).scrollTop(this.last_scroll_top),this.removeIdPrefix(this.old_comments_block),
this.viewer().find(".thevideo.active").remove())},resize:function(){var a=$(window).width(),b=$(window).height();if(this.viewer().hasClass("fullmode"))$("#wpVideoViewer").find(".wpVideoContent, .wpCommentsContent").css("height",b),$("#wpVideoViewer").find(".wpVideo").css("width",a),$("#wpVideoViewer").find(".wpNext, .wpPrev").css("right",0);else{var a=a-50,b=b-50,c=b-70;$("#wpVideoViewer").find(".wpVideoContent, .wpCommentsContent").css("height",c);$("#wpVideoViewer").find(".wpVideo").css("width",
a-400);$("#wpVideoViewer").find(".wpComments").css("width",400);$("#wpVideoViewer").find(".wpNext, .wpPrev").css("right",390)}$("#wpVideoViewer").find(".wpNext, .wpPrev").css("line-height",b+"px");0<this.viewer().find(".videos").width()-100*this.total_count?this.viewer().find(".wpVideoList").addClass("one_col"):this.viewer().find(".wpVideoList").removeClass("one_col");this.hideOptions()},loadVideo:function(){var a=this;$.ajax({url:this.options.urlVideo,data:{format:"json",video_id:this.options.video_id,
isPage:this.options.isPage},dataType:"json",success:function(b){if(b&&b.videos){a.total_count=b.count;a.album_title=b.album_title;a.album_href=b.album_href;a.owner_title=b.owner_title;a.owner_href=b.owner_href;a.videos={};var c=0,d="";$(b.videos).each(function(b,e){d+='<a title="'+e.title+'" href="javascript:void(0);" class="wpVideoItem" onclick="VideoViewer.view('+e.video_id+');" id="wp_'+e.video_id+'"><img id="fullphoto_'+e.video_id+'" src="'+e.thumb+'" alt=""/></a>';a.videos[e.video_id]=e;0==b&&
(c=e.video_id);e.active&&(c=e.video_id)});a.viewer().find(".wpVideoList").find(".videos").html(d);a.viewer().find(".wpVideoList").find(".videos").find("img").load(function(){$(this).addClass("loaded")});a.viewer().find(".wpVideoList").find(".count").html(a.total_count);1<a.total_count&&a.viewer().find(".allVideos").show();a.viewer().find(".goSlideshow").show();a.view(c);a._checkPagination();a.resize()}}})},view:function(a){if(this.videos[a]){var b=this.videos[a];this.viewer().find(".wpVideoItem").removeClass("active");
this.viewer().find("#wp_"+a).addClass("active");var c=this.viewer().find("#wp_"+a).prevAll().length+1,d=this.viewer().find(".wpVideoContent");d.find(".active").removeClass("active").removeClass("fade");var f=d.find("#thevideo_"+a);f.length?(f.addClass("active"),setTimeout(function(){f.addClass("fade")},10)):(d.append($('<div class="thevideo" id="thevideo_'+a+'"><div class="moveElement"><div id="imgPlace_'+a+'">'+b.src+"</div></div></div>")),f=$("#thevideo_"+a),clearTimeout(this.video),this.video=
setTimeout(function(){f.addClass("active");setTimeout(function(){f.addClass("fade")},10)},10));this.resize();this.viewer().find(".wpVideoOptions").find(".info").show();d=this.viewer().find(".wpVideoOptions").find(".album_info");d.find(".album_title").html('<a href="'+b.href+'">'+b.title+"</a>");d.find(".album_owner").html(' - <a href="'+this.owner_href+'">'+this.owner_title+"</a>");this.viewer().find(".wpVideoOptions").find(".count").find(".total").html(this.total_count);this.viewer().find(".wpVideoOptions").find(".count").find(".current").html(c);
this.loadComments(a);this._checkPagination()}},_checkPagination:function(){var a=this.viewer().find(".wpNext"),b=this.viewer().find(".wpPrev");if(2>this.total_count)a.hide(),b.hide();else{var c=this.viewer().find(".wpVideoItem.active");c.prev().length?b.show():b.hide();c.next().length?a.show():a.hide()}},next:function(a){var b=this.viewer().find(".wpVideoItem.active");b.next().length?b.next().click():a?a():this.showList();this._checkPagination()},prev:function(){var a=this.viewer().find(".wpVideoItem.active");
a.prev().length?a.prev().click():this.showList();this._checkPagination()},toggleList:function(){this.viewer().find(".wpVideoList").hasClass("active")?this.hideList():this.showList()},showList:function(){2>this.total_count||this.viewer().hasClass("fullmode")||(this.viewer().find(".videos").jScrollPane(),this.viewer().find(".wpVideoList").addClass("active"),this.showOver())},isListActive:function(){return this.viewer().find(".wpVideoList").hasClass("active")},hideList:function(){this.viewer().find(".wpVideoList").removeClass("active");
this.hideOver()},loadComments:function(a){var b=this;$("#video_comment_"+a).length&&$("#video_comment_"+a).remove();this.comment_request&&this.comment_request.abort();b.showLoading();this.comment_request=$.ajax({url:this.options.urlComment,data:{format:"html",video_id:a,isPage:this.options.isPage},dataType:"json",success:function(c){b.hideLoading();b.setIdPrefix(b.viewer().find(".wpCommentsContent").find(".video_comment").hide());var d=$("<div />").attr({id:"video_comment_"+a,"class":"video_comment"});
d.html($(c.html));b.viewer().find(".wpCommentsContent").append(d);OW.bindAutoClicks($(c.html));OW.bindTips($(c.html));b.addCmpMarkup(c);$("#btn-video-edit-"+a).click(function(){window.edit_video_floatbox=OW.ajaxFloatBox("GVIDEOVIEWER_CMP_EditVideo",{clipId:a},{width:500,iconClass:"ow_ic_edit",title:OW.getLanguageText("video","tb_edit_clip"),onLoad:function(){var c=$("#video-desc-area").get(0);c.htmlarea();c.htmlareaRefresh();owForms.videoEditForm.bind("success",function(c){window.edit_video_floatbox.close();
b.loadComments(a)})}})});$("#video-mark-featured-"+a).click(function(){var a=$(this).attr("rel"),c=$(this).attr("clip-id"),d=this;$.ajax({url:b.options.ajaxResponder,type:"POST",data:{ajaxFunc:"ajaxSetFeaturedStatus",clipId:c,status:a},dataType:"json",success:function(b){if(!0==b.result){var c="remove_from_featured"==a?"mark_featured":"remove_from_featured",e="remove_from_featured"==a?OW.getLanguageText("video","mark_featured"):OW.getLanguageText("video","remove_from_featured");$(d).html('<i class="icon-picture"></i>'+
e);$(d).attr("rel",c);OW.info(b.msg)}else void 0!=b.error&&OW.warning(b.error)}})});$("#video-delete-"+a).click(function(){if(confirm(OW.getLanguageText("video","confirm_delete")))$.ajax({url:b.options.ajaxResponder,type:"POST",data:{ajaxFunc:"ajaxDeleteClip",clipId:a},dataType:"json",success:function(a){!0==a.result?(OW.info(a.msg),a.url&&(document.location=a.url)):void 0!=a.error&&OW.warning(a.error)}});else return!1});$("#btn-video-flag-"+a).click(function(){var a=$(this).attr("rel"),b=$(this).attr("url"),
c=$("#video-description").html();null==c&&(c=a);OW.flagContent("video",a,c,b,"video+flags")})}})},addCmpMarkup:function(a){a.css&&OW.addCss(a.css);a.scriptFiles?OW.addScriptFiles(a.scriptFiles,function(){a.onloadScript&&OW.addScript(a.onloadScript)}):a.onloadScript&&OW.addScript(a.onloadScript)},setIdPrefix:function(a){},removeIdPrefix:function(a){a.find(".iswphprefix").each(function(a,c){var d=$(c).attr("id"),f=d.indexOf("wphEnd");-1!==f&&(d=d.substr(f+6),$(c).attr("id",d),$(c).removeClass("iswphprefix"))})},
onError:function(a){alert(a)},setup:function(){var a=this;this.is_setup||(this.is_setup=!0,$(window).resize(function(){a.resize()}),$(document).bind("keydown",function(b){var c=$(b.target).prop("tagName").toLowerCase();"textarea"!=c&&"input"!=c&&"select"!=c&&(a.isListActive()||(37==b.keyCode?a.prev():39==b.keyCode?a.next():0!=b.keyCode&&(27==b.keyCode?a.viewer().hasClass("fullmode")?a.fullHide():a.hide():109==b.keyCode||38==b.keyCode?a.zoom(2):107!=b.keyCode&&40!=b.keyCode||a.zoom(-2))))}),this.viewer().find(".wpVideo").mousewheel(function(b){if(!a.viewer().hasClass("tagging_process")){b=
b.originalEvent;var c=0;b.wheelDelta&&(c=b.wheelDelta/120);b.detail&&(c=-b.detail/3);a.zoom(c)}}),this.viewer().click(function(b){$(b.target).closest(".external-options").length||$(b.target).hasClass("actions")||$(b.target).parent().hasClass("actions")||a.hideOptions()}),document.addEventListener&&(document.addEventListener("fullscreenchange",function(){},!1),document.addEventListener("mozfullscreenchange",function(){a.fullToggle(document.mozFullScreen)},!1),document.addEventListener("webkitfullscreenchange",
function(){a.fullToggle(document.webkitIsFullScreen)},!1)))},fullToggle:function(a){a?this.fullOpen():this.fullHide()},zoom:function(a){if(!this.isListActive())if(a/=this.options.scale_step,this.scale+=a,this.scale<this.options.min_scale)this.viewer().removeClass("zooming"),this.scale-=a;else if(this.scale>this.options.max_scale)this.scale-=a;else if(this.viewer().addClass("zooming"),$("#wpVideoViewer").find(".wpVideo").find(".active").css("-moz-transform","scale("+this.scale+")").css("-webkit-transform",
"scale("+this.scale+")").css("transform","scale("+this.scale+")"),a=this.getInternetExplorerVersion(),7==a||8==a)a=$("#wpVideoViewer").find(".wpVideo").find(".active").find("img"),a.data("original-width")||(a.data("original-width",a.width()),a.data("original-height",a.height())),a.css("width",a.data("original-width")*this.scale).css("height",a.data("original-height")*this.scale)},getInternetExplorerVersion:function(){var a=-1;"Microsoft Internet Explorer"==navigator.appName&&null!=/MSIE ([0-9]{1,}[.0-9]{0,})/.exec(navigator.userAgent)&&
(a=parseFloat(RegExp.$1));return a},noZoom:function(a){a?this.viewer().addClass("nozoom"):this.viewer().removeClass("nozoom")},fullOpen:function(){var a=this.viewer();a.addClass("fullmode");this.resize();a=a[0];a.requestFullScreen&&a.requestFullScreen();a.webkitRequestFullScreen&&a.webkitRequestFullScreen();a.mozRequestFullScreen&&a.mozRequestFullScreen();a.requestFullscreen&&a.requestFullscreen()},fullHide:function(){this.viewer().removeClass("fullmode");this.resize();this.stopSlideshow();this.viewer().removeClass("slideshow_process");
this.viewer().find(".wpSlideshow").hide();document.cancelFullScreen&&document.cancelFullScreen();document.webkitCancelFullScreen&&document.webkitCancelFullScreen();document.mozCancelFullScreen&&document.mozCancelFullScreen();document.exitFullscreen&&document.exitFullscreen()},viewer:function(){var a=this;if(this.is_viewer)return this.c;this.is_viewer=!0;var b=$("<div />");b.attr({id:"wpVideoViewer","class":"wpVideoViewer"});b.html(this.getHtmlContent());b.appendTo($("body"));var c=this.getInternetExplorerVersion();
-1!==c&&(b.addClass("wpIe"),b.addClass("wpIe"+c));clearTimeout(a.mouseTimer);b.mouseover(function(){clearTimeout(a.mouseTimer);a.mouseTimer=setTimeout(function(){a.viewer().addClass("mouseActive");clearTimeout(a.mouseTimerOut);a.mouseTimerOut=setTimeout(function(){a.viewer().removeClass("mouseActive")},2E3)},10)});var d=b.find(".wpVideoContent");d.unbind("mousemove").mousemove(function(b){if(!$(b.target).closest("#lassoMask").length)return a.is_pressed&&(clearInterval(a.moving_timer),a.moving_timer=
setTimeout(function(){var c=a.move.startClientX-b.clientX,d=a.move.startClientY-b.clientY;a.move.startClientX=b.clientX;a.move.startClientY=b.clientY;a.videoMove(c,d)},1)),!1});d.unbind("mousedown").mousedown(function(b){if(!$(b.target).closest("#lassoMask").length)return a.is_pressed=!0,a.move.startClientX=b.clientX,a.move.startClientY=b.clientY,d.addClass("moving"),!1});d.unbind("mouseup").mouseup(function(b){if(!$(b.target).closest("#lassoMask").length)return a.is_pressed=!1,d.removeClass("moving"),
!1});d.unbind("mouseout").mouseout(function(b){if(!$(b.target).closest("#lassoMask").length)return a.is_pressed=!1,d.removeClass("moving"),!1});return this.c=b},videoMove:function(a,b){var c=$("#thevideo_"+this.getActiveId());this.move.top+=1.5*-b;this.move.left+=1.5*-a;c.css("margin-top",this.move.top);c.css("margin-left",this.move.left)},showOver:function(){var a=this;this.viewer().find(".wpOver").show();clearTimeout(this.timeout);this.timeout=setTimeout(function(){a.viewer().find(".wpOver").addClass("active")},
100)},hideOver:function(){var a=this;a.viewer().find(".wpOver").removeClass("active");clearTimeout(this.timeout);this.timeout=setTimeout(function(){a.viewer().find(".wpOver").hide()},500)},slideshow:function(){this.fullOpen();this.startSlideshow()},slideshowClose:function(){this.stopSlideshow();this.fullHide();this.viewer().removeClass("slideshow_process");this.viewer().find(".wpSlideshow").hide()},startSlideshow:function(){var a=this;this.stopSlideshow();this.slideshow_is_pause=this.slideshow_is_stop=
!1;this.viewer().addClass("slideshow_process");this.slideshow_timer=setInterval(function(){a.slideshow_is_pause||a.next(function(){a.stopSlideshow()})},this.options.slideshow_time);this._checkStatusSlideShow()},stopSlideshow:function(){clearInterval(this.slideshow_timer);this.slideshow_is_stop=!0;this._checkStatusSlideShow()},repeatSlideshow:function(){this.viewer().find(".videos").find("a:first").click();this.startSlideshow();this._checkStatusSlideShow()},_checkStatusSlideShow:function(){this.slideshow_is_pause?
(this.viewer().find(".wpSlidStart").show(),this.viewer().find(".wpSlidPause").hide(),this.viewer().find(".wpSlidRepeat").hide()):this.slideshow_is_stop?(this.viewer().find(".wpSlidStart").hide(),this.viewer().find(".wpSlidPause").hide(),this.viewer().find(".wpSlidRepeat").show()):(this.viewer().find(".wpSlidStart").hide(),this.viewer().find(".wpSlidPause").show(),this.viewer().find(".wpSlidRepeat").hide())},pauseSlideshow:function(){this.slideshow_is_pause=!0;this._checkStatusSlideShow()},hideOptions:function(){$("#video_comment_"+
this.getActiveId()).find(".external-options").hide()},toggleOptions:function(){var a=$("#video_comment_"+this.getActiveId()).find(".external-options");a.toggle();var b=$("#video_comment_"+this.getActiveId()).find(".actions").offset();a.css("top",32).css("left",b.left)},getActiveId:function(){var a=this.viewer().find(".videos").find(".active");if(a.length)return a.attr("id").substr(3)},getActive:function(){return this.videos[this.getActiveId()]},getHtmlContent:function(){return'<div class="wpContainer"><a href="javascript:void(0);" class="wpPrev icon-angle-left" onclick="VideoViewer.prev();" style="display: none;"></a><a href="javascript:void(0);" class="wpNext icon-angle-right" onclick="VideoViewer.next();" style="display: none;"></a><a href="javascript:void(0);" class="wpClose icon-remove" onclick="VideoViewer.hide();"></a><div class="wpVideo"><table width="100%" class="wpVideoContentTable"><tr><td align="center" valign="center" class="wpVideoContent"></td></tr></table></div><div class="wpComments"><div class="wpCommentsContent"><div class="video_comment loadingComments"><div class="layout_page_videoviewer_index_comments"><div class="generic_layout_container layout_main"><span class="loading">'+
OW.getLanguageText("gvideoviewer","loading")+'</span></div></div></div></div></div><div class="wpBar"><div class="wpVideoList"><div class="title">'+OW.getLanguageText("gvideoviewer","all_videos")+'&nbsp;(<span class="count">0</span>)<a href="javascript:void(0);" onclick="VideoViewer.hideList();" class="wpListClose"><i class="icon-remove"></i></a></div><div class="videos"></div></div><div class="wpVideoOptions"><div class="leftside"><a href="javascript:void(0);" class="wpbtn wpbtn-inverse allVideos" onclick="VideoViewer.toggleList();" style="display: none;">'+
OW.getLanguageText("gvideoviewer","all_videos")+'<i class="right icon-caret-up"></i></a><div class="info" style="display: none;"><div class="album_info"><span class="album_title"></span><span class="album_owner"></span></div><div class="count"><span class="current"></span>&nbsp;'+OW.getLanguageText("gvideoviewer","from")+'&nbsp;<span class="total"></span></div></div></div></div></div></div><div class="wpSlideshow" style="display: none;"><a href="javascript:void(0);" onclick="VideoViewer.startSlideshow();" style="display: none;" class="wpSlidStart wpbtn wpbtn-inverse">'+
OW.getLanguageText("gvideoviewer","play")+'</a><a href="javascript:void(0);" onclick="VideoViewer.pauseSlideshow();" style="display: none;" class="wpSlidPause wpbtn wpbtn-inverse">'+OW.getLanguageText("gvideoviewer","pause")+'</a><a href="javascript:void(0);" onclick="VideoViewer.repeatSlideshow();" style="display: none;" class="wpSlidRepeat wpbtn wpbtn-inverse">'+OW.getLanguageText("gvideoviewer","repeat")+'</a><a href="javascript:void(0);" onclick="VideoViewer.slideshowClose();" class="wpSlidClose wpbtn wpbtn-inverse"><i class="icon-remove"></i></a></div><div class="wpOver" onclick="VideoViewer.hideList();" style="display: none;"></div>'},
reset:function(){this.viewer().find(".videos").jScrollPane().data("jsp").destroy();this.viewer().find(".wpOver, .wpNext, .wpPrev, .info, .allVideos, .goSlideshow, .wpSlideshow, .wpSlidStart, .wpSlidPause, .wpSlidRepeat").hide();this.viewer().find(".wpVideoContent, .videos").empty();this.viewer().find(".wpCommentsContent").children().hide();this.viewer().removeClass("fullmode").removeClass("zooming").removeClass("slideshow_process").removeClass("mouseActive");this.viewer().find(".wpVideoList").removeClass(".one_col");
this.viewer().find(".wpCommentsContent").children(".loadingComments").show();return this.viewer()},showLoading:function(){this.viewer().find(".wpCommentsContent").children().hide();this.viewer().find(".wpCommentsContent").children(".loadingComments").show()},hideLoading:function(){this.viewer().find(".wpCommentsContent").children(".loadingComments").hide()},bindVideoViewer:function(){$&&$(".ow_page_container").find("a").not(".wv_init").addClass("wv_init").each(function(a,b){var c=$(b).attr("href");
if(c&&"javascript:void(0)"!=c){var d=0;(c=c.match(/video\/view\/([0-9]{0,})/i))||(d=1);c&&c[0]&&c[1]&&(c=c[1],$(b).unbind("click"),$(b).attr("onclick","").data("video_id",c).data("isPage",d).click(function(a){a.stopPropagation();a.preventDefault();VideoViewer.open({video_id:$(this).data("video_id"),isPage:$(this).data("isPage")})}))}})}};